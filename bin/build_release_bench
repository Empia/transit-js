#!/bin/sh

set -e

cd `dirname $0`/..

mkdir -p target

java -jar deps/closure-compiler/compiler.jar -O ADVANCED --output_wrapper ";(function(){%output%})();" --generate_exports -D TRANSIT_BROWSER_TARGET=true --externs resources/externs.js \
--js deps/closure-library/closure/goog/base.js \
--js deps/closure-library/closure/goog/debug/error.js \
--js deps/closure-library/closure/goog/dom/nodetype.js \
--js deps/closure-library/closure/goog/string/string.js \
--js deps/closure-library/closure/goog/asserts/asserts.js \
--js deps/closure-library/closure/goog/array/array.js \
--js deps/closure-library/closure/goog/object/object.js \
--js deps/closure-library/closure/goog/math/long.js \
--js src/com/cognitect/transit/util.js \
--js src/com/cognitect/transit/delimiters.js \
--js src/com/cognitect/transit/eq.js \
--js src/com/cognitect/transit/types.js \
--js src/com/cognitect/transit/caching.js \
--js src/com/cognitect/transit/impl/decoder.js \
--js src/com/cognitect/transit/impl/reader.js \
--js src/com/cognitect/transit/handlers.js \
--js src/com/cognitect/transit/impl/writer.js \
--js src/com/cognitect/transit.js > target/transit.js
cat target/transit.js bench/seattle.js > target/transit.bench.js
