<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/com/cognitect/transit.js - transit-js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.8.0pr2/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <script src="http://yui.yahooapis.com/combo?3.8.0pr2/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            <h1><a href="../index.html"><img src="../assets/css/logo.png">transit-js: src/com/cognitect/transit.js</a></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.8.667</em>
        </div>
    </div>
    <div class="yui3-g">

        <div id="sidebar" class="yui3-u">
            <div id="modules" class="sidebox">
    <div class="hd">
        <h2 class="no-toc">Modules</h2>
    </div>
    <div class="bd">
        <ul>
            
        </ul>
    </div>
</div>

<div id="classes" class="sidebox">
    <div class="hd">
        <h2 class="no-toc">Classes</h2>
    </div>
    <div class="bd">
        <ul>
            
                <li><a href="../classes/transit.html">transit</a></li>
            
        </ul>
    </div>
</div>










<div id="fileTree" class="sidebox">
    <div class="hd">
        <h2 class="no-toc">Files</h2>
    </div>
    <div class="bd">
        <ul><li>src/<ul><li>com/<ul><li>cognitect/<ul><li><a href="../files/src_com_cognitect_transit.js.html">transit.js</a></li><li>transit/<ul><li><a href="../files/src_com_cognitect_transit_caching.js.html">caching.js</a></li><li><a href="../files/src_com_cognitect_transit_delimiters.js.html">delimiters.js</a></li><li><a href="../files/src_com_cognitect_transit_eq.js.html">eq.js</a></li><li><a href="../files/src_com_cognitect_transit_handlers.js.html">handlers.js</a></li><li>impl/<ul><li><a href="../files/src_com_cognitect_transit_impl_decoder.js.html">decoder.js</a></li><li><a href="../files/src_com_cognitect_transit_impl_reader.js.html">reader.js</a></li><li><a href="../files/src_com_cognitect_transit_impl_writer.js.html">writer.js</a></li></ul></li><li><a href="../files/src_com_cognitect_transit_types.js.html">types.js</a></li></ul></li></ul></li></ul></li></ul></li></ul>
    </div>
</div>



        </div>

        <div id="main" class="yui3-u">
            <div class="content"><h4>src/com/cognitect/transit.js</h4>

<pre class="code prettyprint linenums">
// Copyright 2014 Cognitect. All Rights Reserved.
//
// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an &quot;AS-IS&quot; BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

&quot;use strict&quot;;

goog.provide(&quot;com.cognitect.transit&quot;);
goog.require(&quot;com.cognitect.transit.impl.reader&quot;);
goog.require(&quot;com.cognitect.transit.impl.writer&quot;);
goog.require(&quot;com.cognitect.transit.types&quot;);
goog.require(&quot;com.cognitect.transit.eq&quot;);
goog.require(&quot;com.cognitect.transit.impl.decoder&quot;);

/** @define {boolean} */
var TRANSIT_NODE_TARGET = false;

/** @define {boolean} */
var TRANSIT_BROWSER_TARGET = false;

goog.scope(function() {

/**
 * @class transit
 */
var transit = com.cognitect.transit;

var reader  = com.cognitect.transit.impl.reader,
    writer  = com.cognitect.transit.impl.writer,
    decoder = com.cognitect.transit.impl.decoder,
    types   = com.cognitect.transit.types,
    eq      = com.cognitect.transit.eq;

/**
 * Create a transit reader instance.
 * @method transit.reader
 * @param {string|null} type type of reader to construct.
 *     Default to &quot;json&quot;. For verbose mode supply &quot;json-verbose&quot;.
 * @param {Object|null} opts reader options. A JavaScript object to
 *     customize the writer Valid entries include &quot;defaultHandler&quot;,
 *     and &quot;handler&quot;. &quot;defaultHandler&quot; should be JavaScript function
 *     taking two arguments, the first is the tag, the second the
 *     value. &quot;handlers&quot; should be an object of tags to handle. The
 *     values are functions that will receive the value of matched
 *     tag.
 * @return {transit.reader} A transit reader.
 */
transit.reader = function(type, opts) {
    if(type === &quot;json&quot; || type === &quot;json-verbose&quot; || type == null) {
        type = &quot;json&quot;;
        var unmarshaller = new reader.JSONUnmarshaller(opts);
        return new reader.Reader(unmarshaller, opts);
    } else {
        throw new Error(&quot;Cannot create reader of type &quot; + type);
    }
};

/**
 * Create a transit writer instance.
 * @method transit.writer
 * @param {String|null} type type of writer to construct.
 *     Defaults to &quot;json&quot;. For verbose mode supply &quot;json-verbose&quot;.
 * @param {Object|null} opts writer options. A JavaScript object to
 *     customize the writer. Takes &quot;handlers&quot;, a transit.map of
 *     JavaScript constructor and transit writer handler instance
 *     entries.
 * @return {transit.writer} A transit writer.
 */
transit.writer = function(type, opts) {
    if(type === &quot;json&quot; || type === &quot;json-verbose&quot; || type == null) {
        if(type === &quot;json-verbose&quot;) {
            if(opts == null) opts = {};
            opts[&quot;verbose&quot;] = true;
        }
        type = &quot;json&quot;;
        var marshaller = new writer.JSONMarshaller(opts);
        return new writer.Writer(marshaller, opts);
    } else {
        var err = new Error(&quot;Type must be \&quot;json\&quot;&quot;);
        err.data = {type: type};
        throw err;
    }
};

/**
 * Create a transit writer handler.
 * @method transit.makeWriteHandler
 * @param {Object} obj An object containing 3 functions, tag, rep and stringRep.
 *    &quot;tag&quot; should return a string representing the tag to be written on the wire.
 *    &quot;rep&quot; should return the representation on the wire. &quot;stringRep&quot; is should return
 *    the string representation of the value. Optional &quot;getVerboseHandler&quot; should return a
 *    handler for writing verbose output.
 * @return {transit.handler} A transit write handler.
 */
transit.makeWriteHandler = function(obj) {
    var Handler = function(){};
    Handler.prototype.tag = obj[&quot;tag&quot;];
    Handler.prototype.rep = obj[&quot;rep&quot;];
    Handler.prototype.stringRep = obj[&quot;stringRep&quot;];
    Handler.prototype.getVerboseHandler = obj[&quot;getVerboseHandler&quot;];
    return new Handler();
};

transit.makeBuilder = function(obj) {
    var Builder = function(){};
    Builder.prototype.init = obj[&quot;init&quot;];
    Builder.prototype.add = obj[&quot;add&quot;];
    Builder.prototype.finalize = obj[&quot;finalize&quot;];
    return new Builder();
};

/**
 * Create a transit date.
 * @method transit.date
 * @param {Number|String} A number or string representing milliseconds since epoch.
 * @return {Date} A JavaScript Date.
 */
transit.date = types.date;

/**
 * Create an integer. If given a transit integer or a JavaScript
 *     number will simply return that value. Given a string will
 *     return a JavaScript number if the string represents an integer
 *     value in the 53bit range and a transit integer otherwise.
 * @method transit.integer
 * @param {Number|String|integer} s A value representing an integer.
 * @return {transit.integer} A JavaScript number or transit integer.
 */
transit.integer = types.intValue;

/**
 * Test if an object is a transit integer. Will return true if argument
 * is a 64 bit integer or a JavaScript number that has an interpretation as
 * an integer value, i.e. parseFloat(n) === parseInt(n)
 * @method transit.isInteger
 * @param {Object} x Any JavaScript value.
 * @return {Boolean} true if the value is a transit integer, false otherwise.
 */
transit.isInteger = types.isInteger;

/**
 * Create transit UUID from high and low 64 bits. These integer values
 *      can be constructed with transit.integer.
 * @method transit.uuid
 * @param {transit.integer} high The high 64 bits.
 * @param {transit.integer} low The low 64 bits.
 * @return {transit.uuid} A transit UUID.
 */
transit.uuid = types.uuid;

/**
 * Test if an object is a transit UUID.
 * @method transit.isUUID
 * @param {Object} x Any JavaScript value.
 * @return {Boolean} true if the vlaue is a transit UUID instance, false otherwise.
 */
transit.isUUID = types.isUUID;

/**
 * Create a transit big integer.
 * @method transit.bigInt
 * @param {String} s A string representing an arbitrary size integer value.
 * @return {transit.bigdec} A transit big integer.
 */
transit.bigInt =  types.bigInteger;

/**
 * Test if an object is a transit big integer.
 * @method transit.isBigInt
 * @param {Object} x Any JavaScript value.
 * @return {Boolean} true if x is a transit big integer, false otherwise.
 */
transit.isBigInt = types.isBigInteger;

/**
 * Create a transit big decimal.
 * @method transit.bigDec
 * @param {String} s A string representing an arbitrary precisions decimal value.
 * @return {transit.bigdec} A transit big decimal.
 */
transit.bigDec =  types.bigDecimalValue;

/**
 * Test if an object is a transit big decimal.
 * @method transit.isBigDec
 * @param {Object} x Any JavaScript value.
 * @return {Boolean} true if x is a transit big decimal, false otherwise.
 */
transit.isBigDec = types.isBigDecimal;

/**
 * Create transit keyword.
 * @method transit.keyword
 * @param {String} name A string.
 * @return {transit.keyword} A transit keyword.
 */
transit.keyword = types.keyword;

/**
 * Test if an object is a transit keyword.
 * @method transit.isKeyword
 * @param {Object} x Any JavaScript value.
 * @return {Boolean} true if x is a transit keyword, false otherwise.
 */
transit.isKeyword = types.isKeyword;

/**
 * Create a transit symbol.
 * @method transit.symbol
 * @param {s} name A string.
 * @return {transit.symbol} A transit symbol instance.
 */
transit.symbol = types.symbol;

/**
 * Test if an object is a transit symbol
 * @method transit.isSymbol
 * @param {Object} x Any JavaScript value.
 * @return {Boolean} true if x is a transit symbol, false otherwise.
 */
transit.isSymbol = types.isSymbol;

/**
 * Create transit binary blob.
 * @method transit.binary
 * @param {String} s A base64 encoded string.
 * @return {transit.binary} A transit binary blob instance.
 */
transit.binary = types.binary;

/**
 * Test if an object is a transit binary blob.
 * @method transit.isBinary
 * @param {Object} x Any JavaScript value.
 */
transit.isBinary = types.isBinary;

/**
 * Create a transit URI.
 * @method transit.uri
 * @param {String} A string representing a valid URI.
 * @return {transit.uri} A transit URI.
 */
transit.uri = types.uri;

/**
 * Test if an object is a transit URI.
 * @method transit.isURI
 * @param {Object} Any JavaScript value.
 * @return {Boolean} true if x is a transit symbol, false otherwise.
 */
transit.isURI = types.isURI;

/**
 * Create a transit hash map. Transit maps satisfy the current version
 *     of the ECMAScript 6 Map specification.
 * @method transit.map
 * @param {Array} xs A JavaScript array of alternating key value pairs.
 * @return {transit.map} A transit map.
 */
transit.map = types.map;

/**
 * Test if an object is a transit map.
 * @method transit.isMap
 * @param {Object} x Any JavaScript value.
 * @return {Boolean} true if x is a transit map, false otherwise.
 */
transit.isMap = types.isMap;

/**
 * Create a transit set. Transit sets satisfy the current version of the
 *     of the ECMAScript 6 Set specification.
 * @method transit.set
 * @param {Array} xs A JavaScript array of values.
 * @return {transit.set} A transit set.
 */
transit.set = types.set;

/**
 * Test if an object is a transit set.
 * @method transit.isSet
 * @param {Object} x Any JavaScript value.
 * @return {Boolean} true if x is a transit set, false otherwise.
 */
transit.isSet = types.isSet;

/**
 * Create a transit list.
 * @method transit.list
 * @param {Array} A JavaScript array.
 * @return {transit.list} A transit list.
 */
transit.list = types.list;

/**
 * Test if an object is a transit list.
 * @method transit.isList
 * @param {Object} x Any JavaScript value.
 * @return {Boolean} true if x is a transit list, false otherwise.
 */
transit.isList = types.isList;

/**
 * Create a transit quoted value.
 * @method transit.quoted
 * @param {Object} x Any JavaScript value.
 * @return {transit.quoted} A transit quoted value.
 */
transit.quoted = types.quoted;

/**
 * Test if an object is a transit quoted value.
 * @method transit.isQuoted
 * @param {Object} x Any JavaScript value.
 * @return {Boolean} true if x is a transit value, false otherwise.
 */
transit.isQuoted = types.isQuoted;

/**
 * Create a transit tagged value.
 * @method transit.tagged
 * @param {String} tag A tag.
 * @param {Object} value A JavaScrpt array, object, or string.
 * @return {transit.tagged} A transit tagged value.
 */
transit.tagged = types.taggedValue;

/**
 * Test if an object is a transit tagged value.
 * @method transit.isTaggedValue
 * @param {Object} x Any JavaScript value.
 * @return {Boolean} true if x is a transit value, false otherwise.
 */
transit.isTaggedValue =  types.isTaggedValue;

/**
 * Create a transit link.
 * @method transit.link
 * @param {transit.map} A transit map which must contain at a
 *     minimum the following keys: href, rel. It may optionally include
 *     name, render, and prompt. href must be a transit.uri, all other
 *     values are strings, and render must be either &quot;image&quot; or &quot;link&quot;.
 * @return {Object} A transit link.
 */
transit.link = types.link;

/**
 * Test if an object is a transit link.
 * @method transit.isLink
 * @param {Object} x Any JavaScript object.
 * @return {Boolean} true if x is a transit link, false otherwise.
 */
transit.isLink = types.isLink;

/**
 * Compute the hashCode for any JavaScript object that has been
 *    extend to transit&#x27;s equality and hashing protocol. JavaScript
 *    primitives and transit value are already extended to this protocol.
 *    Custom types may be extended to the protocol via transit.extenToEQ.
 * @method transit.hash
 * @param {Object} x Any JavaScript object that has been extended to
 *    transit&#x27;s equality and hashing protocol.
 * @return {Number} Returns JavaScript number - semantically a 32bit integer.
 */
transit.hash = eq.hashCode;

/**
 * A unique string that can be used to set the hash code on plain
 * JavaScript Objects as well property skip during iteration.
 * @property transit.hashKey
 * @const
 * @type {String}
 */
transit.hashKey = eq.transitHashCodeProperty;

/**
 * Compute the hashCode for JavaScript map-like types - either a JavaScript
 *    object or a JavaScript object that implements ES6 Map forEach.
 * @method transit.hashMapLike
 * @param {Object} x A plain JavaScript Object or Object that implements
 *    ES6 Map forEach.
 * @return {Number} Returns JavaScript number - semantically a 32bit integer.
 */
transit.hashMapLike = eq.hashMapLike;

/**
 * Compute the hashCode for JavaScript array-like types - either a JavaScript
 *    array or a JavaScript object that implements Array forEach.
 * @method transit.hashArrayLike
 * @param {Object} x A JavaScript Array or Object that implements
 *    Array forEach.
 * @return {Number} Returns JavaScript number - semantically a 32bit integer.
 */
transit.hashMapLike = eq.hashArrayLike;

/**
 * Test whether two JavaScript objects represent equal values. The
 *    objects to be tested should be extended to transit&#x27;s equality
 *    and hasing protocol. JavaScript natives and transit value have
 *    already been extended to the protocol, including objects and
 *    arrays.  Also transit maps and JavaScript objects may be
 *    compared for equality. Custom types may be extended via
 *    transit.extendToEQ.
 * @param {Object} x A JavaScript object
 * @param {Object} y A JavaScript object
 * @return {Boolean} true if the x and y are equal, false otherwise.
 */
transit.equals = eq.equals;

/**
 * Extend an object to hashing and equality required by
 *     transit maps and sets. Only required for custom
 *     types, JavaScript primitive types and transit
 *     types are handled.
 * @method transit.extendToEQ
 * @param {Object} x A JavaScript object, will be mutated.
 * @return {Object} x
 */
transit.extendToEQ = eq.extendToEQ;

/**
 * Convert a transit map instance into a JavaScript Object.
 * Throws if the map has keys which have no string representation.
 * @method transit.mapToObject
 * @param {transit.map} m a transit map
 * @return {Object} a JavaScript Object
 */
transit.mapToObject = function(m) {
    var ret = {};
    m.forEach(function(v, k) {
        if(typeof k !== &quot;string&quot;) {
            throw Error(&quot;Cannot convert map with non-string keys&quot;);
        } else {
            ret[k] = v;
        }
    })
    return ret;
};
    
/* The following are undocumented for now */
transit.decoder =        decoder.decoder;
transit.UUIDfromString = types.UUIDfromString;
transit.randomUUID =     types.randomUUID;
transit.stringableKeys = writer.stringableKeys;


if(TRANSIT_BROWSER_TARGET) {
    goog.exportSymbol(&quot;transit.reader&quot;,         transit.reader);
    goog.exportSymbol(&quot;transit.writer&quot;,         transit.writer);
    goog.exportSymbol(&quot;transit.makeBuilder&quot;,    transit.makeBuilder);
    goog.exportSymbol(&quot;transit.makeWriteHandler&quot;, transit.makeWriteHandler);
    goog.exportSymbol(&quot;transit.date&quot;,           types.date);
    goog.exportSymbol(&quot;transit.integer&quot;,        types.intValue);
    goog.exportSymbol(&quot;transit.isInteger&quot;,      types.isInteger);
    goog.exportSymbol(&quot;transit.uuid&quot;,           types.uuid);
    goog.exportSymbol(&quot;transit.isUUID&quot;,         types.isUUID);
    goog.exportSymbol(&quot;transit.bigInt&quot;,         types.bigInteger);
    goog.exportSymbol(&quot;transit.isBigInt&quot;,       types.isBigInteger);
    goog.exportSymbol(&quot;transit.bigDec&quot;,         types.bigDecimalValue);
    goog.exportSymbol(&quot;transit.isBigDec&quot;,       types.isBigDecimal);
    goog.exportSymbol(&quot;transit.keyword&quot;,        types.keyword);
    goog.exportSymbol(&quot;transit.isKeyword&quot;,      types.isKeyword);
    goog.exportSymbol(&quot;transit.symbol&quot;,         types.symbol);
    goog.exportSymbol(&quot;transit.isSymbol&quot;,       types.isSymbol);
    goog.exportSymbol(&quot;transit.binary&quot;,         types.binary);
    goog.exportSymbol(&quot;transit.isBinary&quot;,       types.isBinary);
    goog.exportSymbol(&quot;transit.uri&quot;,            types.uri);
    goog.exportSymbol(&quot;transit.isURI&quot;,          types.isURI);
    goog.exportSymbol(&quot;transit.map&quot;,            types.map);
    goog.exportSymbol(&quot;transit.isMap&quot;,          types.isMap);
    goog.exportSymbol(&quot;transit.set&quot;,            types.set);
    goog.exportSymbol(&quot;transit.isSet&quot;,          types.isSet);
    goog.exportSymbol(&quot;transit.list&quot;,           types.list);
    goog.exportSymbol(&quot;transit.isList&quot;,         types.isList);
    goog.exportSymbol(&quot;transit.quoted&quot;,         types.quoted);
    goog.exportSymbol(&quot;transit.isQuoted&quot;,       types.isQuoted);
    goog.exportSymbol(&quot;transit.tagged&quot;,         types.taggedValue);
    goog.exportSymbol(&quot;transit.isTaggedValue&quot;,  types.isTaggedValue);
    goog.exportSymbol(&quot;transit.link&quot;,           types.link);
    goog.exportSymbol(&quot;transit.isLink&quot;,         types.isLink);
    goog.exportSymbol(&quot;transit.hash&quot;,           eq.hashCode);
    goog.exportSymbol(&quot;transit.hashKey&quot;,        eq.transitHashCodeProperty);
    goog.exportSymbol(&quot;transit.hashMapLike&quot;,    eq.hashMapLike);
    goog.exportSymbol(&quot;transit.hashArrayLike&quot;,  eq.hashArrayLike);
    goog.exportSymbol(&quot;transit.equals&quot;,         eq.equals);
    goog.exportSymbol(&quot;transit.extendToEQ&quot;,     eq.extendToEQ);
    goog.exportSymbol(&quot;transit.mapToObject&quot;,    transit.mapToObject);
    goog.exportSymbol(&quot;transit.decoder&quot;,        decoder.decoder);
    goog.exportSymbol(&quot;transit.UUIDfromString&quot;, types.UUIDfromString);
    goog.exportSymbol(&quot;transit.randomUUID&quot;,     types.randomUUID);
    goog.exportSymbol(&quot;transit.stringableKeys&quot;, writer.stringableKeys);
}

if(TRANSIT_NODE_TARGET) {
    module.exports = {
        reader:         transit.reader,
        writer:         transit.writer,
        makeBuilder:    transit.makeBuilder,
        makeWriteHandler: transit.makeWriteHandler,
        date:           types.date,
        integer:        types.intValue,
        isInteger:      types.isInteger,
        uuid:           types.uuid,
        isUUID:         types.isUUID,
        bigInt:         types.bigInteger,
        isBigInt:       types.isBigInteger,
        bigDec:         types.bigDecimalValue,
        isBigDec:       types.isBigDecimal,
        keyword:        types.keyword,
        isKeyword:      types.isKeyword,
        symbol:         types.symbol,
        isSymbol:       types.isSymbol,
        binary:         types.binary,
        isBinary:       types.isBinary,
        uri:            types.uri,
        isURI:          types.isURI,
        map:            types.map,
        isMap:          types.isMap,
        set:            types.set,
        isSet:          types.isSet,
        list:           types.list,
        isList:         types.isList,
        quoted:         types.quoted,
        isQuoted:       types.isQuoted,
        tagged:         types.taggedValue,
        isTaggedValue:  types.isTaggedValue,
        link:           types.link,
        isLink:         types.isLink,
        hash:           eq.hashCode,
        hashKey:        eq.transitHashCodeProperty,
        hashArrayLike:  eq.hashArrayLike,
        hashMapLike:    eq.hashMapLike,
        equals:         eq.equals,
        extendToEQ:     eq.extendToEQ,
        mapToObject:    transit.mapToObject,
        decoder:        decoder.decoder,
        UUIDfromString: types.UUIDfromString,
        randomUUID:     types.randomUUID,
        stringableKeys: writer.stringableKeys
    };
}

});

</pre>

</div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/js/tabs.js"></script>
</body>
</html>
