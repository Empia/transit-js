<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/com/cognitect/transit/handlers.js - transit-js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.8.0pr2/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <script src="http://yui.yahooapis.com/combo?3.8.0pr2/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            <h1><a href="../index.html"><img src="../assets/css/cognitect.jpg" width="100">transit-js: src/com/cognitect/transit/handlers.js</a></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.8.770</em>
        </div>
    </div>
    <div class="yui3-g">

        <div id="sidebar" class="yui3-u">
            <div id="classes" class="sidebox">
                <div class="hd">
                    <h2 class="no-toc">Classes</h2>
                </div>
                <div class="bd">
                    <ul>
                            <li><a href="../classes/transit.html">transit</a></li>
                    </ul>
                </div>
            </div>
            
            
            
            
            
            <div id="fileTree" class="sidebox">
                <div class="hd">
                    <h2 class="no-toc">Files</h2>
                </div>
                <div class="bd">
                    <ul><li>src/<ul><li>com/<ul><li>cognitect/<ul><li><a href="../files/src_com_cognitect_transit.js.html">transit.js</a></li><li>transit/<ul><li><a href="../files/src_com_cognitect_transit_caching.js.html">caching.js</a></li><li><a href="../files/src_com_cognitect_transit_delimiters.js.html">delimiters.js</a></li><li><a href="../files/src_com_cognitect_transit_eq.js.html">eq.js</a></li><li><a href="../files/src_com_cognitect_transit_handlers.js.html">handlers.js</a></li><li>impl/<ul><li><a href="../files/src_com_cognitect_transit_impl_decoder.js.html">decoder.js</a></li><li><a href="../files/src_com_cognitect_transit_impl_reader.js.html">reader.js</a></li><li><a href="../files/src_com_cognitect_transit_impl_writer.js.html">writer.js</a></li></ul></li><li><a href="../files/src_com_cognitect_transit_types.js.html">types.js</a></li><li><a href="../files/src_com_cognitect_transit_util.js.html">util.js</a></li></ul></li></ul></li></ul></li></ul></li></ul>
                </div>
            </div>
            
        </div>

        <div id="main" class="yui3-u">
            <div class="content"><h4>src/com/cognitect/transit/handlers.js</h4>

<pre class="code prettyprint linenums">
// Copyright 2014 Cognitect. All Rights Reserved.
//
// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an &quot;AS-IS&quot; BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

goog.provide(&quot;com.cognitect.transit.handlers&quot;);
goog.require(&quot;com.cognitect.transit.util&quot;);
goog.require(&quot;com.cognitect.transit.types&quot;);
goog.require(&quot;goog.math.Long&quot;);

goog.scope(function() {

var handlers = com.cognitect.transit.handlers,
    util     = com.cognitect.transit.util,
    types    = com.cognitect.transit.types,
    Long     = goog.math.Long;

handlers.ctorGuid = 0;

/**
 * @const
 * @type {string}
 */
handlers.ctorGuidProperty = &quot;transit$guid$&quot; + util.randomUUID();

handlers.typeTag = function(ctor) {
    if(ctor == null) {
        return &quot;null&quot;;
    } else if(ctor === String) {
        return &quot;string&quot;;
    } else if(ctor === Boolean) {
        return &quot;boolean&quot;;
    } else if(ctor === Number) {
        return &quot;number&quot;;
    } else if(ctor === Array) {
        return &quot;array&quot;;
    } else if(ctor === Object) {
        return &quot;map&quot;;
    } else {
        var tag = ctor[handlers.ctorGuidProperty];
        if(tag == null) {
            if(typeof Object.defineProperty != &quot;undefined&quot;) {
                tag = ++handlers.ctorGuid;
                Object.defineProperty(ctor, handlers.ctorGuidProperty, {
                    value: tag,
                    enumerable: false
                });
            } else {
                ctor[handlers.ctorGuidProperty] = tag = ++handlers.ctorGuid;
            }
        }
        return tag;
    }
};

handlers.constructor = function(x) {
    if(x == null) {
        return null;
    } else {
        return x.constructor;
    }
};

handlers.padZeros = function(n,m) {
    var s = n.toString();
    for(var i = s.length; i &lt; m; i++) {
        s = &quot;0&quot;+s;
    }
    return s;
};

handlers.stringableKeys = function(m) {
    var stringable = false,
    ks = util.objectKeys(m);

    for(var i = 0; i &lt; ks.length; i++) {
    }

    return true;
};

/**
 * @constructor
 */
handlers.NilHandler = function(){};
handlers.NilHandler.prototype.tag = function(v) { return &quot;_&quot;; };
handlers.NilHandler.prototype.rep = function(v) { return null; };
handlers.NilHandler.prototype.stringRep = function(v) { return &quot;null&quot;; };

/**
 * @constructor
 */
handlers.StringHandler = function(){};
handlers.StringHandler.prototype.tag = function(v) { return &quot;s&quot;; };
handlers.StringHandler.prototype.rep = function(v) { return v; };
handlers.StringHandler.prototype.stringRep = function(v) { return v; };

/**
 * @constructor
 */
handlers.NumberHandler = function(){};
handlers.NumberHandler.prototype.tag = function(v) { return &quot;i&quot;; };
handlers.NumberHandler.prototype.rep = function(v) { return v; };
handlers.NumberHandler.prototype.stringRep = function(v) { return v.toString(); };

/**
 * @constructor
 */
handlers.IntegerHandler = function(){};
handlers.IntegerHandler.prototype.tag = function(v) { return &quot;i&quot;; };
handlers.IntegerHandler.prototype.rep = function(v) { return v.toString(); };
handlers.IntegerHandler.prototype.stringRep = function(v) { return v.toString(); };

/**
 * @constructor
 */
handlers.BooleanHandler = function(){};
handlers.BooleanHandler.prototype.tag = function(v) { return &quot;?&quot;; };
handlers.BooleanHandler.prototype.rep = function(v) { return v; };
handlers.BooleanHandler.prototype.stringRep = function(v) { return v.toString(); };

/**
 * @constructor
 */
handlers.ArrayHandler = function(){};
handlers.ArrayHandler.prototype.tag = function(v) { return &quot;array&quot;; };
handlers.ArrayHandler.prototype.rep = function(v) { return v; };
handlers.ArrayHandler.prototype.stringRep = function(v) { return null; };

/**
 * @constructor
 */
handlers.MapHandler = function(){};
handlers.MapHandler.prototype.tag = function(v) { return &quot;map&quot;; };
handlers.MapHandler.prototype.rep = function(v) { return v; };
handlers.MapHandler.prototype.stringRep = function(v) { return null; };

/**
 * @constructor
 */
handlers.VerboseDateHandler = function(){};
handlers.VerboseDateHandler.prototype.tag = function(v) { return &quot;t&quot;; };
handlers.VerboseDateHandler.prototype.rep = function(v) {
    return v.getUTCFullYear()+&quot;-&quot;+handlers.padZeros(v.getUTCMonth()+1,2)+&quot;-&quot;+
           handlers.padZeros(v.getUTCDate(),2)+&quot;T&quot;+handlers.padZeros(v.getUTCHours(),2)+&quot;:&quot;+
           handlers.padZeros(v.getUTCMinutes(),2)+&quot;:&quot;+handlers.padZeros(v.getUTCSeconds(),2)+&quot;.&quot;+
           handlers.padZeros(v.getUTCMilliseconds(),3)+&quot;Z&quot;;
};
handlers.VerboseDateHandler.prototype.stringRep = function(v, h) {
    return h.rep(v);
};

/**
 * @constructor
 */
handlers.DateHandler = function(){};
handlers.DateHandler.prototype.tag = function(v) { return &quot;m&quot;; };
handlers.DateHandler.prototype.rep = function(v) { return v.valueOf(); };
handlers.DateHandler.prototype.stringRep = function(v) { return v.valueOf().toString(); };
handlers.DateHandler.prototype.getVerboseHandler = function(v) {
    return new handlers.VerboseDateHandler();
};

/**
 * @constructor
 */
handlers.UUIDHandler = function(){};
handlers.UUIDHandler.prototype.tag = function(v) { return &quot;u&quot;; };
handlers.UUIDHandler.prototype.rep = function(v) { return v.toString(); };
handlers.UUIDHandler.prototype.stringRep = function(v) { return v.toString(); };

/**
 * @constructor
 */
handlers.KeywordHandler = function(){};
handlers.KeywordHandler.prototype.tag = function(v) { return &quot;:&quot;; };
handlers.KeywordHandler.prototype.rep = function(v) { return v.name; }; // NOTE: should be fqn
handlers.KeywordHandler.prototype.stringRep = function(v, h) { return h.rep(v); };

/**
 * @constructor
 */
handlers.SymbolHandler = function(){};
handlers.SymbolHandler.prototype.tag = function(v) { return &quot;$&quot;; };
handlers.SymbolHandler.prototype.rep = function(v) { return v.name; }; // NOTE: should be str
handlers.SymbolHandler.prototype.stringRep = function(v, h) { return h.rep(v); };

/**
 * @constructor
 */
handlers.TaggedHandler = function(){};
handlers.TaggedHandler.prototype.tag = function(v) { return v.tag; };
handlers.TaggedHandler.prototype.rep = function(v) { return v.rep; };
handlers.TaggedHandler.prototype.stringRep = function(v, h) { return null; };

/**
 * @constructor
 */
handlers.TransitSetHandler = function(){};
handlers.TransitSetHandler.prototype.tag = function(v) { return &quot;set&quot;; };
handlers.TransitSetHandler.prototype.rep = function(v) {
    var arr = [];
    v.forEach(function(key, set) {
        arr.push(key);
    });
    return types.taggedValue(&quot;array&quot;, arr);
};
handlers.TransitSetHandler.prototype.stringRep = function(v, h) { return null; };

/**
 * @constructor
 */
handlers.TransitArrayMapHandler = function(){};
handlers.TransitArrayMapHandler.prototype.tag = function(v) { return &quot;map&quot;; };
handlers.TransitArrayMapHandler.prototype.rep = function(v) { return v; };
handlers.TransitArrayMapHandler.prototype.stringRep = function(v, h) { return null; };

/**
 * @constructor
 */
handlers.TransitMapHandler = function(){};
handlers.TransitMapHandler.prototype.tag = function(v) { return &quot;map&quot;; };
handlers.TransitMapHandler.prototype.rep = function(v) { return v; };
handlers.TransitMapHandler.prototype.stringRep = function(v, h) { return null; };

/**
 * @constructor
 */
handlers.BufferHandler = function() {};
handlers.BufferHandler.prototype.tag = function(v) { return &quot;b&quot;; };
handlers.BufferHandler.prototype.rep = function(v) { return v.toString(&quot;base64&quot;); };
handlers.BufferHandler.prototype.stringRep = function(v, h) { return null; };

/**
 * @constructor
 */
handlers.Uint8ArrayHandler = function() {};
handlers.Uint8ArrayHandler.prototype.tag = function(v) { return &quot;b&quot;; };
handlers.Uint8ArrayHandler.prototype.rep = function(v) { return util.Uint8ToBase64(v); };
handlers.Uint8ArrayHandler.prototype.stringRep = function(v, h) { return null; };

handlers.defaultHandlers = function(hs) {
    hs.set(null, new handlers.NilHandler());
    hs.set(String, new handlers.StringHandler());
    hs.set(Number, new handlers.NumberHandler());
    hs.set(Long, new handlers.IntegerHandler());
    hs.set(Boolean, new handlers.BooleanHandler());
    hs.set(Array, new handlers.ArrayHandler());
    hs.set(Object, new handlers.MapHandler());
    hs.set(Date, new handlers.DateHandler());
    hs.set(types.UUID, new handlers.UUIDHandler());
    hs.set(types.Keyword, new handlers.KeywordHandler());
    hs.set(types.Symbol, new handlers.SymbolHandler());
    hs.set(types.TaggedValue, new handlers.TaggedHandler());
    hs.set(types.TransitSet, new handlers.TransitSetHandler());
    hs.set(types.TransitArrayMap, new handlers.TransitArrayMapHandler());
    hs.set(types.TransitMap, new handlers.TransitMapHandler());

    if(typeof Buffer != &quot;undefined&quot;) {
        hs.set(Buffer, new handlers.BufferHandler());
    }

    if(typeof Uint8Array != &quot;undefined&quot;) {
        hs.set(Uint8Array, new handlers.Uint8ArrayHandler());
    }

    return hs;
};

/**
 * @constructor
 */
handlers.Handlers = function() {
    this.handlers = {};
    handlers.defaultHandlers(this);
};

handlers.Handlers.prototype.get = function(ctor) {
    var h = null;
    if(typeof ctor === &quot;string&quot;) {
        h = this.handlers[ctor];
    } else {
        h = this.handlers[handlers.typeTag(ctor)];
    }
    if(h != null) {
        return h;
    } else {
        return this.handlers[&quot;default&quot;];
    }
};
handlers.Handlers.prototype[&quot;get&quot;] = handlers.Handlers.prototype.get;

handlers.validTag = function(tag) {
    switch(tag) {
        case &quot;null&quot;:
        case &quot;string&quot;:
        case &quot;boolean&quot;:
        case &quot;number&quot;:
        case &quot;array&quot;:
        case &quot;map&quot;:
        return false;
        break;
    }
    return true;
};

handlers.Handlers.prototype.set = function(ctor, handler) {
    if(typeof ctor === &quot;string&quot; &amp;&amp; handlers.validTag(ctor)) {
        this.handlers[ctor] = handler;
    } else {
        this.handlers[handlers.typeTag(ctor)] = handler;
    }
};

});    

</pre>

</div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/js/tabs.js"></script>
</body>
</html>
